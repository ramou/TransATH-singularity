<?php

//Getting Post Values from HTML Form
$evalue = $_POST["evalue"];
$percent = $_POST["percent"];
$email = $_POST["user_name"];

//echo " POST DATA =>" . var_dump($_POST);
//Creating folders based on timestamps and email address
//$move_path="/home/ijah/A-Works/TransportersX/gBlast/uploads";
//Unable permission denied

$fileName = $_FILES["file1"]["name"]; // The file name
$fileTmpLoc = $_FILES["file1"]["tmp_name"]; // File in the PHP tmp folder
$fileType = $_FILES["file1"]["type"]; // The type of file it is
$fileSize = $_FILES["file1"]["size"]; // File size in bytes
$fileErrorMsg = $_FILES["file1"]["error"]; // 0 for false... and 1 for true
if (!$fileTmpLoc) { // if file not chosen
    echo "ERROR: Please browse for a file before clicking the upload button.";
    exit();
}
if(move_uploaded_file($fileTmpLoc, "uploads/$fileName")){
    echo "$fileName upload is complete and result was processed";
	/*
	//$ufile="file:///var/www/Project/uploads/$fileName";
	$ufile="/var/www/html/Gblast2/$fileName";
	$bfile="file:///var/www/html/Gblast2/gblast.pl";

	//exec("$bfile") or die("error");

	$perlscript_file="/usr/bin/perl ./gblast.pl $ufile $evalue $percent";
	//exec("cd /home/home/ijah/A-Works/TransportersX/gBlast");
	//exec("./gblast.pl ../Protein_sequences/AnigerTest");

	ob_start();
	passthru($perlscript_file);
	$perlreturn = ob_get_contents();
	ob_end_clean();*/


	/*$cmd = './gblast.pl uploads/'.$fileName;
	//echo '<pre>';
	//passthru($cmd);
	//echo '</pre>';

	while (@ ob_end_flush()); // end all output buffers if any

	$proc = popen($cmd, 'r');
	echo '<pre>';
	while (!feof($proc))
	{
	    echo fread($proc, 4096);
	    @ flush();
	}
	echo '</pre>';*/

	/*$cmd = "ping -c 10 127.0.0.1";

	$descriptorspec = array(
	   0 => array("pipe", "r"),   // stdin is a pipe that the child will read from
	   1 => array("pipe", "w"),   // stdout is a pipe that the child will write to
	   2 => array("pipe", "w")    // stderr is a pipe that the child will write to
	);
	flush();
	$process = proc_open($cmd, $descriptorspec, $pipes, realpath('./'), array());
	echo "<pre>";
	if (is_resource($process)) {
	    while ($s = fgets($pipes[1])) {
		print $s;
		flush();
	    }
	}
	echo "</pre>";*/

	// tell php to automatically flush after every output
	// including lines of output produced by shell commands

	function disable_ob() {
	    // Turn off output buffering
	    ini_set('output_buffering', 'off');
	    // Turn off PHP output compression
	    ini_set('zlib.output_compression', false);
	    // Implicitly flush the buffer(s)
	    ini_set('implicit_flush', true);
	    ob_implicit_flush(true);
	    // Clear, and turn off output buffering
	    while (ob_get_level() > 0) {
		// Get the curent level
		$level = ob_get_level();
		// End the buffering
		ob_end_clean();
		// If the current level has not changed, abort
		if (ob_get_level() == $level) break;
	    }
	    // Disable apache output buffering/compression
	    if (function_exists('apache_setenv')) {
		apache_setenv('no-gzip', '1');
		apache_setenv('dont-vary', '1');
	    }
	}

	disable_ob();

	for($i=0;$i<10;$i++) 
	{
	    echo $i . "\n";
	    usleep(300000);
	}

} else {
    echo "move_uploaded_file function failed";
}

//$cmd = 'ping -c 10 127.0.0.1';

/*while (@ ob_end_flush()); // end all output buffers if any

$proc = popen($cmd, 'r');
echo '<pre>';
while (!feof($proc))
{
    echo fread($proc, 4096);
    @ flush();
}
echo '</pre>';*/

//exec("/usr/bin/perl /home/ijah/A-Works/TransportersX/gBlast/gblast.pl ../Protein_sequences/SuffianTest/AnigerTest2");
?>
